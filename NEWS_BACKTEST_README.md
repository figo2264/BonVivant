# 하이브리드 백테스트 가이드 (기술적 분석 + 뉴스 감정 분석)

## 개요
`run_news_backtest.py`는 기술적 분석과 뉴스 감정 분석을 결합한 하이브리드 백테스트 시스템입니다. 먼저 기술적 지표로 종목을 선정한 후, 각 종목에 대해 뉴스 감정 분석을 수행하여 종합적인 투자 결정을 내립니다.

## 주요 기능
1. **뉴스 수집 테스트**: 특정 종목의 뉴스 수집 및 감정 분석 테스트
2. **파라미터 최적화**: 최적의 보유 기간과 매수 기준 확률 학습
3. **하이브리드 백테스트**: 기술적 분석 + 뉴스 감정 분석 결합 전략
4. **전략 비교**: 기술적 분석만 vs 하이브리드 전략 성과 비교

## 하이브리드 전략 작동 방식

### 1단계: 기술적 분석으로 종목 선정
- RSI, MACD, 볼린저 밴드 등 기술적 지표 활용
- 모멘텀과 거래량 분석
- 상위 종목 선별

### 2단계: 뉴스 감정 분석 추가
- 선정된 각 종목에 대해 최근 뉴스 수집 (매일경제)
- Claude API로 뉴스 감정 분석 및 상승 확률 예측
- 뉴스 점수 산출 (긍정/중립/부정 및 신뢰도)

### 3단계: 종합 점수 계산
- 종합 점수 = 기술적 점수(70%) + 뉴스 점수(30%)
- 종합 점수 0.6 이상인 종목만 매수
- 점수에 따라 투자 금액 차등 적용

### 4단계: 매수/매도 실행
- 종합 점수가 높은 순서대로 매수
- 설정된 보유 기간 후 자동 매도
- 손실 제한 (-5%) 적용

## 설정 방법

### 1. 환경 변수 설정
`.env` 파일을 프로젝트 루트에 생성하고 Claude API 키를 추가:
```
ANTHROPIC_API_KEY=your-api-key-here
```

### 2. 필수 패키지 설치
```bash
pip install anthropic selenium webdriver-manager beautifulsoup4 pykrx
```

## 사용 방법

### 실행
```bash
python run_news_backtest.py
```

### 메뉴 옵션

#### 1) 뉴스 수집 테스트
- 특정 종목의 뉴스 수집이 잘 되는지 확인
- 종목 코드 입력 예시: `005930,035420,000660`
- 디버그 모드를 활성화하면 브라우저 창이 표시됨

#### 2) 파라미터 최적화
- 2010~2019년 데이터로 최적 보유 기간과 매수 기준 학습
- 현재는 시뮬레이션 값 반환 (실제 구현 필요)

#### 3) 하이브리드 백테스트 (최근 30일)
- 최근 30일간의 데이터로 하이브리드 전략 백테스트 실행
- 기술적 분석으로 선정 → 뉴스 감정 분석 추가 → 종합 평가

#### 4) 하이브리드 백테스트 (커스텀 기간)
- 원하는 기간(일 단위)으로 백테스트 실행

#### 5) 전략 비교
- 기술적 분석만 사용한 전략과 하이브리드 전략 비교
- 3개월 기간으로 비교 테스트

## 점수 체계

### 기술적 점수 (70% 가중치)
- RSI, MACD, 볼린저 밴드 신호
- 거래량 및 모멘텀 지표
- 0.0 ~ 1.0 범위

### 뉴스 점수 (30% 가중치)
- 뉴스 감정 (긍정/중립/부정)
- Claude API 신뢰도
- 0.0 ~ 1.0 범위

### 종합 점수
- 종합 점수 = 기술적 점수 × 0.7 + 뉴스 점수 × 0.3
- 매수 기준: 0.6 이상
- 투자 금액 조정:
  - 0.8 이상: 130% 투자
  - 0.7~0.8: 110% 투자
  - 0.6~0.7: 100% 투자
  - 0.6 미만: 80% 투자
  - 뉴스 감정이 부정적인 경우: 추가 30% 감소

## 디버그 모드
디버그 모드를 활성화하면:
- 브라우저가 headless 모드로 실행되지 않음 (화면에 표시)
- 상세한 로그 메시지 출력
- 뉴스 크롤링 과정 확인 가능
- 종목별 점수 계산 과정 확인

## 주요 개선사항
1. **하이브리드 전략**: 기술적 분석과 뉴스 분석을 결합
2. **종합 점수 시스템**: 두 가지 분석을 가중 평균하여 더 정확한 매수 신호 생성
3. **동적 투자 금액**: 종합 점수에 따라 투자 금액 조정
4. **회사명 자동 조회**: pykrx를 사용하여 종목 코드로 회사명 자동 조회
5. **캐싱 기능**: 회사명 조회 결과를 캐시하여 성능 향상

## 백테스트 결과 해석
- **총 수익률**: 초기 자본 대비 최종 수익률
- **거래 횟수**: 매수/매도 총 횟수
- **승률**: 수익을 낸 거래의 비율
- **최대 손실**: 최고점 대비 최대 하락폭

## 주의사항
- Claude API 키가 필요합니다
- 매일경제 웹사이트 구조가 변경되면 크롤링이 실패할 수 있습니다
- 실제 투자에는 사용하지 마세요 (백테스트 결과는 과거 데이터 기반)
- 뉴스 수집에 시간이 걸릴 수 있습니다 (종목당 3-5초)

## 문제 해결
- **뉴스가 수집되지 않는 경우**:
  - 회사명이 정확한지 확인
  - 디버그 모드로 실행하여 크롤링 과정 확인
  - 매일경제 웹사이트 접속 확인

- **Claude API 오류**:
  - API 키 확인
  - API 사용량 한도 확인
  - 네트워크 연결 확인

- **종합 점수가 낮은 경우**:
  - 기술적 지표와 뉴스 감정이 상충할 수 있음
  - 가중치 조정 고려 (현재 7:3)
